<%- include('partials/head') %>
<%- include('partials/navbar') %>

<div class="grid-containersx">
    <div class="grid-itemsx item1x">
        <%- include('partials/menu') %>
    </div>
    <div class="grid-itemsx item2x">
      <div class="container">
      <form id="stockForm">
        <label for="part_no">Part Number:</label>
        <input type="text" id="part_no" name="part_no" required><br><br>
      
        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" name="quantity" required><br><br>
      
        <button type="button" onclick="submitForm('IN')" class="in">IN</button>
        <button type="button" onclick="submitForm('OUT')"  class="out">OUT</button>
      </form>
      
      <div id="message"></div>
      
      <canvas id="myChart2" width="370" height="220"></canvas>
    </div>
  </div>
</div>



<link rel="stylesheet" href="/styles.css">
<script>
  const ctx2 = document.getElementById("myChart2").getContext("2d");

  const gradient2 = ctx2.createLinearGradient(0, 0, 0, 800);
  gradient2.addColorStop(0, "rgb(0, 128, 255)");
  gradient2.addColorStop(0.5, "rgb(0, 255, 128)");
  gradient2.addColorStop(1, "rgb(255, 128, 0)");
  
  const myChart2 = new Chart(ctx2, {
    type: "bar",
    data: {
      labels: [],
      datasets: [
        {
          label: "Core BRS Line 4",
          data: [],
          backgroundColor: gradient2,
          borderColor: "rgba(0, 0, 0, 0)",
          borderWidth: 1,
        },
      ],
    },
    options: {
      responsive: true,
      scales: {
        x: {
          title: { display: true, text: "Part Number", color: "white", font: { size: 12 } },
          ticks: { color: "white", font: { size: 18 } },
          grid: { color: "rgba(186, 223, 238, 0.5)" },
        },
        y: {
          beginAtZero: true,
          title: { display: true, text: "Change", color: "white", font: { size: 12 } },
          ticks: { color: "white" },
          grid: { color: "rgba(186, 223, 238, 0.5)" },
        },
      },
      plugins: {
        legend: { labels: { color: "lightblue", font: { size: 14 } } },
        datalabels: {
          color: "white",
          anchor: "center",
          align: "center",
          font: { weight: "bold", size: 16 },
          formatter: (value) => value,
        },
      },
    },
    plugins: [ChartDataLabels],
  });
  
  setInterval(() => {
    fetch('http://192.168.1.103/api/getCoreBRS4')
      .then(response => response.json())
      .then(data => {
        myChart2.data.labels = data.ppLb;
        myChart2.data.datasets[0].data = data.ppQty;
        myChart2.update();
      })
      .catch(error => {
        console.error('Error fetching data:', error);
      });
  }, 1000);
  

  function submitForm(type) {
    const partNo = document.getElementById("part_no").value;
    const quantity = parseInt(document.getElementById("quantity").value);
    
    if (!partNo || !quantity) {
      document.getElementById("message").innerText = "Please enter both part number and quantity.";
      return;
    }

    const data = {
      part_no: partNo,
      quantity: quantity,
      type: type,
    };
  
    fetch('http://192.168.1.103/api/updateStock4', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    })
    .then(response => response.json())
    .then(result => {
      document.getElementById("message").innerText = result.message;
    })
    .catch(error => {
      document.getElementById("message").innerText = "Error: " + error.message;
    });
  }
</script>
</body>
</html>
<title>Stock Form</title>
  <style>

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      min-height: 100%;
      border-radius: 12px;
    }
    
    #stockForm {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #2a2a3e;
      padding: 10px;
      border-radius: 10px;
      border: 2px solid #000;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      width: 100%;
      margin-bottom: 30px;
    }

    #stockForm label {
      display: block;
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 8px;
      color: #fff;
    }

    #stockForm input {
      width: 20%;
      padding: 10px;
      margin-right: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 14px;
    }

    #stockForm button {
      width: 80px;
      padding: 10px;
      margin-left: 10px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      color: white;
    }

    #stockForm button:hover {
      opacity: 0.8;
    }

    .in{
      background-color: #28a745;
    }

    .out {
      background-color: #dc3545;
    }

    #message {
      font-size: 16px;
      margin-top: 20px;
      color: #007bff;
    }

  </style>
